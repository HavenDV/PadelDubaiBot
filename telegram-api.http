@TELEGRAM_BOT_TOKEN={{$dotenv TELEGRAM_BOT_TOKEN}}
@NEXT_PUBLIC_APP_URL={{$dotenv NEXT_PUBLIC_APP_URL}}
@PRODUCTION_APP_URL={{$dotenv PRODUCTION_APP_URL}}

### Set Production Webhook
GET https://api.telegram.org/bot{{TELEGRAM_BOT_TOKEN}}/setWebhook?url={{PRODUCTION_APP_URL}}api/telegram/webhook

### Set Webhook
GET https://api.telegram.org/bot{{TELEGRAM_BOT_TOKEN}}/setWebhook?url={{NEXT_PUBLIC_APP_URL}}api/telegram/webhook

### Get Webhook Info
GET https://api.telegram.org/bot{{TELEGRAM_BOT_TOKEN}}/getWebhookInfo

### Test telegram bot API locally

POST http://localhost:3000/api/telegram/webhook
Content-Type: application/json

{
  "message": {
    "chat": {
      "id": -123456789
    },
    "message_id": 123,
    "text": "@padel_dubai_bot tell me something"
  }
}

### Test skill level registration (links should be preserved)
POST http://localhost:3000/api/telegram/webhook
Content-Type: application/json

{
  "callback_query": {
    "id": "test_callback_id",
    "from": {
      "id": 123456,
      "username": "testuser",
      "first_name": "Test"
    },
    "message": {
      "chat": {
        "id": -123456789
      },
      "message_id": 456,
      "text": "üéæ –í—Ç–æ—Ä–Ω–∏–∫, 07.01, 8:00-09:30\n\nüìç –ú–µ—Å—Ç–æ: <a href=\"https://maps.app.goo.gl/GZgQCpsX1uyvFwLB7?g_st=ipc\">SANDDUNE PADEL CLUB Al Qouz</a>\nüíµ –¶–µ–Ω–∞: 65 aed/—á–µ–ª\nüèüÔ∏è –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ –∫–æ—Ä—Ç–æ–≤: 2\n\nüìÖ <a href=\"https://calendar.google.com/calendar/render?action=TEMPLATE&text=Padel%20-%20SANDDUNE%20PADEL%20CLUB%20Al%20Qouz&dates=20250107T040000Z/20250107T053000Z&location=SANDDUNE%20PADEL%20CLUB%20Al%20Qouz\">–î–æ–±–∞–≤–∏—Ç—å –≤ Google Calendar</a>\n\n–ó–∞–ø–∏—Å–∞–≤—à–∏–µ—Å—è –∏–≥—Ä–æ–∫–∏:\n\n‚è≥ Waitlist:\n_–ü—É—Å—Ç–æ_"
    },
    "data": "skill_D+"
  }
}

### Test registration when game is full (will go to waitlist)
POST http://localhost:3000/api/telegram/webhook
Content-Type: application/json

{
  "callback_query": {
    "id": "test_callback_id_2",
    "from": {
      "id": 123457,
      "username": "fifthplayer",
      "first_name": "Fifth"
    },
    "message": {
      "chat": {
        "id": -123456789
      },
      "message_id": 456,
      "text": "üéæ –í—Ç–æ—Ä–Ω–∏–∫, 07.01, 8:00-09:30\n\nüìç –ú–µ—Å—Ç–æ: SANDDUNE PADEL CLUB Al Qouz\nüíµ –¶–µ–Ω–∞: 65 aed/—á–µ–ª\nüèüÔ∏è –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ –∫–æ—Ä—Ç–æ–≤: 2\n\n–ó–∞–ø–∏—Å–∞–≤—à–∏–µ—Å—è –∏–≥—Ä–æ–∫–∏:\n\n1. @player1 (D+)\n2. @player2 (D)\n3. @player3 (D+)\n4. @player4 (C-)"
    },
    "data": "skill_D"
  }
}

### Test cancellation from main game (will move waitlist player to main game + notification)
POST http://localhost:3000/api/telegram/webhook
Content-Type: application/json

{
  "callback_query": {
    "id": "test_callback_id_3",
    "from": {
      "id": 123458,
      "username": "player2",
      "first_name": "Player2"
    },
    "message": {
      "chat": {
        "id": -123456789
      },
      "message_id": 456,
      "text": "üéæ –í—Ç–æ—Ä–Ω–∏–∫, 07.01, 8:00-09:30\n\nüìç –ú–µ—Å—Ç–æ: SANDDUNE PADEL CLUB Al Qouz\nüíµ –¶–µ–Ω–∞: 65 aed/—á–µ–ª\nüèüÔ∏è –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ –∫–æ—Ä—Ç–æ–≤: 2\n\n–ó–∞–ø–∏—Å–∞–≤—à–∏–µ—Å—è –∏–≥—Ä–æ–∫–∏:\n\n1. @player1 (D+)\n2. @player2 (D)\n3. @player3 (D+)\n4. @player4 (C-)\n\n‚è≥ Waitlist:\n1. @fifthplayer (D)"
    },
    "data": "skill_not_coming"
  }
}

### Test cancellation from waitlist (no notification)
POST http://localhost:3000/api/telegram/webhook
Content-Type: application/json

{
  "callback_query": {
    "id": "test_callback_id_4",
    "from": {
      "id": 123459,
      "username": "fifthplayer",
      "first_name": "Fifth"
    },
    "message": {
      "chat": {
        "id": -123456789
      },
      "message_id": 456,
      "text": "üéæ –í—Ç–æ—Ä–Ω–∏–∫, 07.01, 8:00-09:30\n\nüìç –ú–µ—Å—Ç–æ: SANDDUNE PADEL CLUB Al Qouz\nüíµ –¶–µ–Ω–∞: 65 aed/—á–µ–ª\nüèüÔ∏è –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ –∫–æ—Ä—Ç–æ–≤: 2\n\n–ó–∞–ø–∏—Å–∞–≤—à–∏–µ—Å—è –∏–≥—Ä–æ–∫–∏:\n\n1. @player1 (D+)\n2. @player2 (D)\n3. @player3 (D+)\n4. @player4 (C-)\n\n‚è≥ Waitlist:\n1. @fifthplayer (D)\n2. @sixthplayer (D+)"
    },
    "data": "skill_not_coming"
  }
}

### Test admin game cancellation (admin user only)
POST http://localhost:3000/api/telegram/webhook
Content-Type: application/json

{
  "callback_query": {
    "id": "admin_test_callback",
    "from": {
      "id": 123456789,
      "username": "admin_user",
      "first_name": "Admin"
    },
    "message": {
      "chat": {
        "id": -123456789
      },
      "message_id": 456,
      "text": "üéæ <b>–í—Ç–æ—Ä–Ω–∏–∫, 07.01, 8:00-09:30</b>\n\nüìç <b>–ú–µ—Å—Ç–æ:</b> <a href=\"https://maps.app.goo.gl/test\">SANDDUNE PADEL CLUB Al Qouz</a>\nüíµ <b>–¶–µ–Ω–∞:</b> 65 aed/—á–µ–ª\nüèüÔ∏è <b>–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ –∫–æ—Ä—Ç–æ–≤:</b> 2\n\nüìÖ <a href=\"https://calendar.google.com/test\">–î–æ–±–∞–≤–∏—Ç—å –≤ Google Calendar</a>\n\n<b>–ó–∞–ø–∏—Å–∞–≤—à–∏–µ—Å—è –∏–≥—Ä–æ–∫–∏:</b>\n\n1. @player1 (D+)\n2. @player2 (D)\n\n‚è≥ <b>Waitlist:</b>\n_–ü—É—Å—Ç–æ_"
    },
    "data": "admin_cancel_game"
  }
}

### Test admin unauthorized access (non-admin user)
POST http://localhost:3000/api/telegram/webhook
Content-Type: application/json

{
  "callback_query": {
    "id": "non_admin_test_callback",
    "from": {
      "id": 999999999,
      "username": "regular_user",
      "first_name": "Regular"
    },
    "message": {
      "chat": {
        "id": -123456789
      },
      "message_id": 456,
      "text": "üéæ <b>–í—Ç–æ—Ä–Ω–∏–∫, 07.01, 8:00-09:30</b>\n\n<b>–ó–∞–ø–∏—Å–∞–≤—à–∏–µ—Å—è –∏–≥—Ä–æ–∫–∏:</b>\n\n1. @player1 (D+)\n\n‚è≥ <b>Waitlist:</b>\n_–ü—É—Å—Ç–æ_"
    },
    "data": "admin_cancel_game"
  }
}

### Test admin game statistics
POST http://localhost:3000/api/telegram/webhook
Content-Type: application/json

{
  "callback_query": {
    "id": "admin_stats_callback",
    "from": {
      "id": 123456789,
      "username": "admin_user",
      "first_name": "Admin"
    },
    "message": {
      "chat": {
        "id": -123456789
      },
      "message_id": 456,
      "text": "üéæ <b>–í—Ç–æ—Ä–Ω–∏–∫, 07.01, 8:00-09:30</b>\n\n<b>–ó–∞–ø–∏—Å–∞–≤—à–∏–µ—Å—è –∏–≥—Ä–æ–∫–∏:</b>\n\n1. @player1 (D+)\n2. @player2 (D)\n3. @player3 (D+)\n4. @player4 (C-)\n\n‚è≥ <b>Waitlist:</b>\nüéæ @waitlist1 (D+)\nüéæ @waitlist2 (D)"
    },
    "data": "admin_game_stats"
  }
}

### Test weekly schedule creation

GET http://localhost:3000/api/telegram/create-poll